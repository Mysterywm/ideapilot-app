"use strict";var w=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var _=(r,e)=>{for(var n in e)w(r,n,{get:e[n],enumerable:!0})},N=(r,e,n,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of I(e))!A.call(r,t)&&t!==n&&w(r,t,{get:()=>e[t],enumerable:!(o=k(e,t))||o.enumerable});return r};var R=r=>N(w({},"__esModule",{value:!0}),r);var W={};_(W,{DEFAULT_OPTIONS:()=>l,LanyardError:()=>S,SocketEvents:()=>O,SocketOpcode:()=>v,get:()=>P,getURL:()=>h,useLanyard:()=>F,useLanyardWS:()=>q});module.exports=R(W);var f=require("react");var E=require("react"),x=class{map=new Map;get(e,n){let o=this.map.get(e);if(!o){let t={state:"initial",isLoading:!1,data:n,error:void 0};return this.map.set(e,t),t}return o}set(e,n){this.map.set(e,n)}delete(e){this.map.delete(e)}},D=(0,E.createContext)({listeners:new Set,stateMap:new x});function g(){return(0,E.useContext)(D)}var l={api:{hostname:"api.lanyard.rest",secure:!0}};var L=require("@prequist/lanyard");var S=class extends Error{constructor(n,o,t){super(t.error.message);this.request=n;this.response=o;this.body=t;this.code=this.response.status}code};function h(r,e=l){return`${e.api.secure?"https":"http"}://${e.api.hostname}/v1/users/${r}`}async function P(r,e=l){let n=h(r,e),o={method:"GET",signal:e.controller?.signal??null,headers:{Accept:"application/json"}},t=new Request(n,o),i=await fetch(t),p=await i.json();return L.API.isErrored(i,p)?{success:!1,error:new S(t,i,p)}:{success:!0,data:p.data}}var u=require("react"),C=typeof window<"u"?u.useInsertionEffect:()=>{};function m(r){let e=(0,u.useRef)(r);return C(()=>{e.current=r},[r]),(0,u.useCallback)(function(){return e.current.apply(this,arguments)},[])}function F(r,e){let n={...l,...e},o=g(),t=m(s=>{o.stateMap.set(r,s);for(let d of o.listeners)d()}),i=m(()=>{let s=o.stateMap.get(r,n.initialData);if(!s)throw new Error("State not found");return s}),p=m(s=>{t({...i(),isLoading:s})}),c=m(async s=>{if(i().isLoading)return;p(!0);let d=await P(r,s?{...n,controller:s}:n);d.error?t({...i(),state:"errored",error:d.error,isLoading:!1}):t({...i(),state:"loaded",data:d.data,isLoading:!1})});(0,f.useEffect)(()=>{let s=new AbortController;return c(s),()=>{s.abort()}},[c]);let a=(0,f.useCallback)(s=>(o.listeners.add(s),()=>{o.listeners.delete(s)}),[r]);return{...(0,f.useSyncExternalStore)(a,i,i),revalidate:c}}var b=require("react");var v=(t=>(t[t.Event=0]="Event",t[t.Hello=1]="Hello",t[t.Initialize=2]="Initialize",t[t.Heartbeat=3]="Heartbeat",t))(v||{}),O=(n=>(n.INIT_STATE="INIT_STATE",n.PRESENCE_UPDATE="PRESENCE_UPDATE",n))(O||{}),U=1e4;function q(r,e){let n={...l,...e},[o,t]=(0,b.useState)(),p=`${n.api.secure?"wss":"ws"}://${n.api.hostname}/socket`;return(0,b.useEffect)(()=>{if(typeof window>"u")return;if(!("WebSocket"in window))throw new Error("Lanyard failed to connect: The WebSocket API is not supported in this browser.");let c,a;function T(){c&&clearInterval(c),a=new WebSocket(p),a.addEventListener("close",T),a.addEventListener("message",s)}function s(d){let y=JSON.parse(d.data);switch(y.op){case 1:{c=setInterval(()=>{a.readyState===a.OPEN&&a.send(JSON.stringify({op:3}))},y.d?.heartbeat_interval??U),a.readyState===a.OPEN&&a.send(JSON.stringify({op:2,d:{subscribe_to_id:r}}));break}case 0:{switch(y.t){case"INIT_STATE":case"PRESENCE_UPDATE":{y.d&&t(y.d);break}default:break}break}default:break}}return T(),()=>{clearInterval(c),a.removeEventListener("close",T),a.removeEventListener("message",s),a.close()}},[p]),o??n.initialData}0&&(module.exports={DEFAULT_OPTIONS,LanyardError,SocketEvents,SocketOpcode,get,getURL,useLanyard,useLanyardWS});
